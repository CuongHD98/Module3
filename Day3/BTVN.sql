CREATE DATABASE BTVN;
USE BTVN;
CREATE TABLE NHACUNGCAP(
	MaNhaCC INT PRIMARY KEY AUTO_INCREMENT,
    TenNhaCC VARCHAR(255),
    DiaChi VARCHAR(255),
    SoDT VARCHAR(255),
    MaSoThue VARCHAR(255)
);
CREATE TABLE LOAIDICHVU(
	MaLoaiDV INT PRIMARY KEY AUTO_INCREMENT,
    TenLoaiDV VARCHAR(255)
);
CREATE TABLE MUCPHI(
	MaMP INT PRIMARY KEY AUTO_INCREMENT,
    DonGia FLOAT,
    MoTa VARCHAR(255)
);
CREATE TABLE DONGXE(
	DongXe VARCHAR(255) PRIMARY KEY,
    HangXe VARCHAR(255),
    SoChoNgoi INT
);
CREATE TABLE DANGKYCUNGCAP(
	MaDKCC INT PRIMARY KEY AUTO_INCREMENT,
    MaNhaCC INT,
    MaLoaiDV INT,
    MaMP INT,
    DongXe VARCHAR(255),
    NgayBatDauCungCap DATETIME,
    NgayKetThucCungCap DATETIME,
    SoLuongXeDangKy INT,
    FOREIGN KEY(MaNhaCC) REFERENCES NHACUNGCAP(MaNhaCC),
    FOREIGN KEY(MaLoaiDV) REFERENCES LOAIDICHVU(MaLoaiDV),
    FOREIGN KEY(MaMP) REFERENCES MUCPHI(MaMP),
    FOREIGN KEY(DongXe) REFERENCES DONGXE(DongXe)
);

INSERT INTO NHACUNGCAP(TenNhaCC, DiaChi, SoDT, MaSoThue)
 VALUES('Nha cung cap A', 'Dia chi A', '0123456781', 'MST A'),
		('Nha cung cap B', 'Dia chi B', '0123456782', 'MST B'),
		('Nha cung cap C', 'Dia chi C', '0123456783', 'MST C'),
		('Nha cung cap D', 'Dia chi D', '0123456784', 'MST D');
INSERT INTO LOAIDICHVU(TenLoaiDV) 
VALUES('Loai dich vu A'),       
		('Loai dich vu B'),       
		('Loai dich vu C'),       
		('Loai dich vu D');   
INSERT INTO MUCPHI(DonGia,MoTa)
VALUES(1,'Mo Ta A'),        
		(2,'Mo Ta B'),        
		(3,'Mo Ta C'),        
		(4,'Mo Ta D');       
INSERT INTO DONGXE(DongXe, HangXe, SoChoNgoi) 
VALUES('Dong xe A', 'Hang xe A', 10),       
		('Dong xe B', 'Hang xe B', 20),       
		('Dong xe C', 'Hang xe C', 30),       
		('Dong xe D', 'Hang xe D', 40);  
INSERT INTO DANGKYCUNGCAP(MaNhaCC, MaLoaiDV, MaMP, DongXe, NgayBatDauCungCap, NgayKetThucCungCap, SoLuongXeDangKy) 
VALUES(1, 1, 1, 'Dong xe A', '2023-06-14', '2023-06-30', 5),        
		(2, 2, 2, 'Dong xe B', '2023-06-10', '2023-06-28', 6),        
		(3, 3, 3, 'Dong xe C', '2023-06-12', '2023-06-25', 7),        
		(4, 4, 4, 'Dong xe D', '2023-06-06', '2023-06-18', 8); 
        
SELECT DongXe, SoChoNgoi FROM DONGXE WHERE SoChoNgoi > 5;

SELECT NHACUNGCAP.TenNhaCC, NHACUNGCAP.DiaChi, NHACUNGCAP.SoDT, DANGKYCUNGCAP.DongXe
FROM NHACUNGCAP
INNER JOIN DANGKYCUNGCAP ON NHACUNGCAP.MaNhaCC = DANGKYCUNGCAP.MaNhaCC
INNER JOIN MUCPHI ON DANGKYCUNGCAP.MaMP = MUCPHI.MaMP
INNER JOIN DONGXE ON DANGKYCUNGCAP.DongXe = DONGXE.DongXe
WHERE DONGXE.HangXe = 'Toyota' AND MUCPHI.DonGia = 15000;   
   
SELECT * FROM NHACUNGCAP ORDER BY TenNhaCC ASC, MaSoThue DESC; 

SELECT NHACUNGCAP.TenNhaCC, COUNT(DANGKYCUNGCAP.MaDKCC) AS SoLuotDangKy, NOW() AS TIMENOW
FROM NHACUNGCAP
INNER JOIN DANGKYCUNGCAP ON NHACUNGCAP.MaNhaCC = DANGKYCUNGCAP.MaNhaCC
WHERE DANGKYCUNGCAP.NgayBatDauCungCap = '2023-06-14'
GROUP BY NHACUNGCAP.TenNhaCC;

SELECT DISTINCT HangXe FROM DONGXE;

SELECT DANGKYCUNGCAP.MaDKCC, NHACUNGCAP.MaNhaCC, NHACUNGCAP.TenNhaCC, 
NHACUNGCAP.DiaChi, NHACUNGCAP.MaSoThue, LOAIDICHVU.TenLoaiDV, 
DICHVU.DonGia, DONGXE.HangXe, DANGKYCUNGCAP.NgayBatDau, DANGKYCUNGCAP.NgayKetThuc
FROM NHACUNGCAP
LEFT JOIN DANGKYCUNGCAP ON NHACUNGCAP.MaNhaCC = DANGKYCUNGCAP.MaNhaCC
LEFT JOIN DICHVU ON DICHVU.MaDV = DANGKYCUNGCAP.MaDV
LEFT JOIN LOAIDICHVU ON LOAIDICHVU.MaLoaiDV = DICHVU.MaLoaiDV
LEFT JOIN DONGXE ON DONGXE.MaXe = DICHVU.MaXe
WHERE DANGKYCUNGCAP.MaDKCC IS NULL;

SELECT NHACUNGCAP.*
FROM NHACUNGCAP
LEFT JOIN DANGKYCUNGCAP ON NHACUNGCAP.MaNhaCC = DANGKYCUNGCAP.MaNhaCC
WHERE DANGKYCUNGCAP.MaDKCC IS NULL;

SELECT NHACUNGCAP.*
FROM NHACUNGCAP
INNER JOIN DANGKYCUNGCAP ON NHACUNGCAP.MaNhaCC = DANGKYCUNGCAP.MaNhaCC
INNER JOIN DONGXE ON DONGXE.DongXe = DANGKYCUNGCAP.DongXe
WHERE DONGXE.HangXe = 'Hiace';

INSERT INTO DANGKYCUNGCAP(MaNhaCC, MaLoaiDV, MaMP, DongXe, NgayBatDauCungCap, NgayKetThucCungCap, SoLuongXeDangKy) 
VALUES(1, 1, 1, 'Dong xe A', '2023-06-14', '2023-06-30', 5);



